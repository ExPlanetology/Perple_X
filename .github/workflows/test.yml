name: CI

on: [push, pull_request]

jobs:
  build:
    name: Build - ${{ matrix.os }}
    runs-on: ${{ matrix.os }}
    strategy:
      fail-fast: false
      matrix:
        os:
          - ubuntu-latest
          - macOS-latest
          - windows-latest
    steps:
    - name: Checkout code
      uses: actions/checkout@v3
      
    - name: Install GCC compilers macOS
      if: contains( matrix.os, 'macOS')
      run: |
          brew install gcc@12 
          sudo ln -s $(which gfortran-12) $(dirname $(which gfortran-12))/gfortran
    - name: Install compilers windows
      if: contains( matrix.os, 'windows')
      run: |
          choco install cmake

    - name: Compile sources
      run: |
        make -C sources -f makefile
    - name: Compile libraries
      run: |
        make -C sources -f makefile clean
        make -C sources -f makefile FLINK='-shared' FFLAGS='-fPIC -O3'
